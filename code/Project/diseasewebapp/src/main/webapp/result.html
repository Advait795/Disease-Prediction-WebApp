<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/result.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <title>Disease Prediction Result</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>Test Report</h2>
        </div>
        <div class="wrapper">
            <div class="collapsible">
                <input type="checkbox" id="collapsible-head-1">
                <label for="collapsible-head-1">Hypertension Report</label>
                <div class="collapsible-text" id="result-1"></div>
            </div>
            <div class="collapsible">
                <input type="checkbox" id="collapsible-head-2">
                <label for="collapsible-head-2">Stroke Report</label>
                <div class="collapsible-text" id="result-2"></div>
            </div>
            <div class="collapsible">
                <input type="checkbox" id="collapsible-head-3">
                <label for="collapsible-head-3">Diabetes Report</label>
                <div class="collapsible-text" id="result-3"></div>
            </div>
        </div>
    </div>
    <script>

        function clearUrl() {
            const url = new URL(window.location.href);
            url.search = '';
            window.history.replaceState(null, '', url);
        }

        // window.onload = function() {
        //     // Static data for demonstration
        //     const predictedClasses = {
        //         hypertension: 100,
        //         stroke: 94,
        //         diabetes: 46
        //     };

        //     const featuresPred = {
        //         hypertension: {
        //             '1': 4.0,
        //             '2': 21.0,
        //             '3': 28.0,
        //             '4': 25.0,
        //             '5': 14.0,
        //             '6': 28.0,
        //             '7': 44.0,
        //             '8': 16.0,
        //             '9': 28.0,
        //             '10': 4.0,
        //             '11': 2.0,
        //             '13': 1.0
        //         },
        //         stroke: {
        //             '1': 33.0,
        //             '2': 9.0,
        //             '3': 28.0,
        //             '4': 25.0,
        //             '5': 52.0,
        //             '6': 8.0,
        //             '7': 36.0,
        //             '8': 20.0,
        //             '9': 5.0,
        //             '10': 45.0
        //         },
        //         diabetes: {
        //             '1': 33.0,
        //             '2': 9.0,
        //             '3': 28.0,
        //             '4': 25.0,
        //             '6': 5.0,
        //             '7': 44.0,
        //             '8': 20.0
        //         }
        //     };

        //     const diseases = Object.keys(predictedClasses);
        //     diseases.forEach((disease, index) => {     
        //         const prediction = predictedClasses[disease];
        //         const featureData = featuresPred[disease];

        //         const collapsibleText = document.getElementById(`result-${index + 1}`);

        //         collapsibleText.innerHTML = 
        //             `<h2>${disease.charAt(0).toUpperCase() + disease.slice(1)}</h2>
        //             <h3>Predicted possibility: ${prediction}%</h3>
        //             <div class="chart-container">
        //                 <canvas class="chart" id="polar-area-${index + 1}"></canvas>
        //                 <canvas class="chart" id="bar-chart-${index + 1}"></canvas>
        //             </div>`;

        //         const labels = Object.keys(featureData);
        //         const data = Object.values(featureData);
        //         const backgroundColor = generateColor(labels.length);
        //         const borderColor = generateColor(labels.length);

        //         const polarData = {
        //             labels: labels,
        //             datasets: [{
        //                 label: 'Feature Predictions',
        //                 data: data,
        //                 backgroundColor: backgroundColor,
        //                 borderColor: borderColor,
        //                 borderWidth: 1
        //             }]
        //         };

        //         let polarCtx = document.getElementById(`polar-area-${index + 1}`).getContext('2d');
        //         new Chart(polarCtx, {
        //             type: 'polarArea',
        //             data: polarData,
        //             options: {
        //                 responsive: true,
        //                 maintainAspectRatio: false,
        //                 scales: {
        //                     r: {
        //                         beginAtZero: true
        //                     }
        //                 }
        //             }
        //         });

        //         let barCtx = document.getElementById(`bar-chart-${index + 1}`).getContext('2d');
        //         new Chart(barCtx, {
        //             type: 'bar',
        //             data: polarData,
        //             options: {
        //                 responsive: true,
        //                 maintainAspectRatio: false,
        //                 scales: {
        //                     y: {
        //                         beginAtZero: true
        //                     }
        //                 }
        //             }
        //         });
        //     });
        // };

        // function generateColor(count) {
        //     const colors = [
        //         'rgba(255, 99, 132, 0.6)',
        //         'rgba(54, 162, 235, 0.6)',
        //         'rgba(255, 206, 86, 0.6)',
        //         'rgba(75, 192, 192, 0.6)',
        //         'rgba(153, 102, 255, 0.6)',
        //         'rgba(255, 159, 64, 0.6)',
        //         'rgba(255, 99, 132, 0.6)',
        //         'rgba(54, 162, 235, 0.6)',
        //         'rgba(255, 206, 86, 0.6)',
        //         'rgba(75, 192, 192, 0.6)',
        //         'rgba(153, 102, 255, 0.6)',
        //         'rgba(255, 159, 64, 0.6)',
        //         'rgba(54, 162, 235, 0.6)'
        //     ];
        //     return colors.slice(0, count);
        // }

        
        window.onload = function() {
            const url = new URLSearchParams(window.location.search);
            const predictedClasses = JSON.parse(decodeURIComponent(url.get('predictedClasses')));
            const featuresPred = JSON.parse(decodeURIComponent(url.get('featuresPred')));

            console.log(predictedClasses);
            console.log(featuresPred);

            const diseases = Object.keys(predictedClasses);
            console.log(diseases);
            diseases.forEach((disease, index) => {     
                const prediction = predictedClasses[disease];
                const featureData = featuresPred[disease];

                const collapsibleText = document.getElementById(`result-${index +1}`);

                collapsibleText.innerHTML = 
                    `<h2>${disease.charAt(0).toUpperCase() + disease.slice(1)}</h2>
                    <h3>Predicted possibility: ${prediction}%</h3>
                    <div class="chart-container">
                        <canvas class="chart" id="polar-area-${index + 1}"></canvas>
                        <canvas class="chart" id="bar-chart-${index + 1}"></canvas>
                    </div>`;

                const labels = Object.keys(featureData);
                const data = Object.values(featureData);
                const backgroundColor = generateColor(labels.length);
                const borderColor = generateColor(labels.length);

                const polarData = {
                    labels: labels,
                    datasets: [{
                        label: 'Feature Predictions',
                        data: data,
                        backgroundColor: backgroundColor,
                        borderColor: borderColor,
                        borderWidth: 1
                    }]
                };

                let polarCtx = document.getElementById(`polar-area-${index + 1}`).getContext('2d');
                new Chart(polarCtx, {
                    type: 'polarArea',
                    data: polarData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                let barCtx = document.getElementById(`bar-chart-${index + 1}`).getContext('2d');
                new Chart(barCtx, {
                    type: 'bar',
                    data: polarData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
        };

        function generateColor(count) {
            const colors = [
                'rgba(255, 99, 132, 0.6)',
                'rgba(54, 162, 235, 0.6)',
                'rgba(255, 206, 86, 0.6)',
                'rgba(75, 192, 192, 0.6)',
                'rgba(153, 102, 255, 0.6)',
                'rgba(255, 159, 64, 0.6)',
                'rgba(255, 99, 132, 0.6)',
                'rgba(54, 162, 235, 0.6)',
                'rgba(255, 206, 86, 0.6)',
                'rgba(75, 192, 192, 0.6)',
                'rgba(153, 102, 255, 0.6)',
                'rgba(255, 159, 64, 0.6)',
                'rgba(54, 162, 235, 0.6)'
            ];
            return colors.slice(0, count);
        }
    
    </script>
</body>
</html>